<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>小胜音乐</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5', // 主色调：深紫色
                        secondary: '#818CF8', // 辅助色：淡紫色
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .scrollbar-thin {
                scrollbar-width: thin;
            }
            .scrollbar-thin::-webkit-scrollbar {
                width: 4px;
            }
            .scrollbar-thin::-webkit-scrollbar-thumb {
                background-color: rgba(156, 163, 175, 0.5);
                border-radius: 2px;
            }
            .text-shadow {
                text-shadow: 0 1px 2px rgba(0,0,0,0.1);
            }
            .backdrop-blur {
                backdrop-filter: blur(8px);
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-dark font-sans h-screen flex flex-col overflow-hidden">
    <!-- 主容器 -->
    <div class="flex flex-1 overflow-hidden flex-col">
        <!-- 顶部导航栏 -->
        <header class="bg-white border-b border-gray-100 shadow-sm py-3 px-4 sticky top-0 z-20">
            <div class="flex items-center justify-between">
                <h1 class="text-xl font-bold text-primary flex items-center">
                    <i class="fa fa-music mr-2"></i>
                    <span>小胜音乐</span>
                </h1>
                
                <div class="flex items-center space-x-3">
                    <button id="playlist-btn" class="relative p-2 text-gray-600 hover:text-primary transition-colors">
                        <i class="fa fa-list"></i>
                        <span id="playlist-count" class="absolute -top-1 -right-1 bg-primary text-white text-xs rounded-full w-4 h-4 flex items-center justify-center hidden">0</span>
                    </button>
                </div>
            </div>
            
            <!-- 搜索框 -->
            <div class="relative mt-3">
                <input 
                    type="text" 
                    id="search-input" 
                    placeholder="搜索歌曲或歌手..." 
                    class="w-full bg-gray-100 border border-gray-200 rounded-full py-2 px-4 pl-10 focus:outline-none focus:ring-2 focus:ring-primary/50 text-sm"
                >
                <i class="fa fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
            </div>
        </header>
        
        <!-- 主内容区 -->
        <main class="flex-1 overflow-y-auto scrollbar-thin bg-gray-50">
            <!-- 加载状态 -->
            <div id="loading-state" class="flex flex-col items-center justify-center h-full">
                <div class="w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mb-4"></div>
                <p class="text-gray-500">加载音乐中...</p>
            </div>
            
            <!-- 错误状态 -->
            <div id="error-state" class="hidden flex flex-col items-center justify-center h-full p-6 text-center">
                <div class="w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mb-4">
                    <i class="fa fa-exclamation-triangle text-2xl text-red-500"></i>
                </div>
                <h3 class="text-lg font-medium text-gray-700 mb-2">加载失败</h3>
                <p class="text-gray-500 mb-4">无法连接到音乐资源，请检查网络或稍后重试</p>
                <button id="retry-btn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
                    重试
                </button>
            </div>
            
            <!-- 歌曲列表 -->
            <div id="songs-container" class="hidden">
                <!-- 搜索结果提示 -->
                <div id="search-result-hint" class="p-4 text-gray-500 text-sm hidden">
                    搜索 "<span id="search-keyword" class="text-primary font-medium"></span>"，找到 <span id="search-result-count"></span> 首歌曲
                </div>
                
                <!-- 歌曲列表 -->
                <ul class="divide-y divide-gray-100">
                    <!-- 歌曲项将通过JS动态生成 -->
                </ul>
            </div>
            
            <!-- 空结果状态 -->
            <div id="empty-result-state" class="hidden flex flex-col items-center justify-center h-full p-6 text-center">
                <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                    <i class="fa fa-search text-2xl text-gray-400"></i>
                </div>
                <h3 class="text-lg font-medium text-gray-700 mb-2">没有找到结果</h3>
                <p class="text-gray-500">尝试使用其他关键词搜索</p>
            </div>
        </main>
        
        <!-- 播放控制栏 -->
        <footer id="player-controls" class="bg-white border-t border-gray-100 py-2 px-4 shadow-md z-20">
            <div class="flex items-center">
                <!-- 当前播放歌曲信息 -->
                <div class="flex items-center w-2/5">
                    <div id="now-playing-cover" class="w-12 h-12 bg-primary/10 rounded overflow-hidden flex-shrink-0 shadow-sm">
                        <img src="https://picsum.photos/200/200?random=1" alt="专辑封面" class="w-full h-full object-cover">
                    </div>
                    <div class="ml-3 overflow-hidden">
                        <h4 id="now-playing-title" class="text-sm font-medium truncate">未播放歌曲</h4>
                        <p id="now-playing-artist" class="text-xs text-gray-500 truncate">未知歌手</p>
                    </div>
                </div>
                
                <!-- 播放控制按钮 -->
                <div class="flex-1 flex flex-col items-center justify-center">
                    <div class="flex items-center space-x-4 mb-1">
                        <button id="prev-btn" class="text-gray-600 hover:text-primary transition-colors disabled:opacity-30 disabled:pointer-events-none">
                            <i class="fa fa-step-backward"></i>
                        </button>
                        <button id="play-pause-btn" class="w-10 h-10 rounded-full bg-primary flex items-center justify-center text-white hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:pointer-events-none">
                            <i class="fa fa-play"></i>
                        </button>
                        <button id="next-btn" class="text-gray-600 hover:text-primary transition-colors disabled:opacity-30 disabled:pointer-events-none">
                            <i class="fa fa-step-forward"></i>
                        </button>
                    </div>
                    
                    <!-- 进度条 -->
                    <div class="w-full flex items-center space-x-1">
                        <span id="current-time" class="text-xs text-gray-500 w-8 text-right">0:00</span>
                        <div class="relative flex-1 h-1 bg-gray-200 rounded-full overflow-hidden">
                            <div id="progress-bar" class="absolute top-0 left-0 h-full bg-primary w-0 transition-all"></div>
                        </div>
                        <span id="total-time" class="text-xs text-gray-500 w-8">0:00</span>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- 歌单弹窗 -->
    <div id="playlist-modal" class="fixed inset-0 bg-black/50 backdrop-blur z-50 hidden flex-col">
        <div class="bg-white rounded-t-2xl mt-auto max-h-[80vh] flex flex-col">
            <div class="p-4 border-b border-gray-100 flex justify-between items-center">
                <h2 class="text-lg font-bold text-gray-800">我的歌单</h2>
                <button id="close-playlist-btn" class="p-2 text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            
            <div id="playlist-songs" class="flex-1 overflow-y-auto scrollbar-thin p-2">
                <!-- 歌单为空状态 -->
                <div id="empty-playlist" class="flex flex-col items-center justify-center h-40 text-center p-4">
                    <i class="fa fa-heart-o text-3xl text-gray-300 mb-2"></i>
                    <p class="text-gray-500">歌单还是空的</p>
                    <p class="text-gray-400 text-sm mt-1">点击歌曲右侧的爱心添加喜欢的音乐</p>
                </div>
                
                <!-- 歌单项将通过JS动态生成 -->
            </div>
        </div>
    </div>

    <script>
        // 配置 - 替换为你的GitHub仓库songs文件夹地址
        // 注意：需要使用GitHub Pages或启用CORS的链接
        const SONGS_BASE_URL = "https://github.com/chenshenggggg/musicPlayer/tree/main/songs";
        
        // 音频元素
        const audioElement = new Audio();
        
        // 歌曲数据
        let allSongs = [];      // 所有歌曲
        let filteredSongs = []; // 过滤后的歌曲
        let playlist = [];      // 我的歌单
        
        // 当前播放状态
        let currentState = {
            currentSong: null,
            isPlaying: false
        };

        // DOM元素
        const elements = {
            // 状态容器
            loadingState: document.getElementById('loading-state'),
            errorState: document.getElementById('error-state'),
            songsContainer: document.getElementById('songs-container'),
            emptyResultState: document.getElementById('empty-result-state'),
            
            // 搜索相关
            searchInput: document.getElementById('search-input'),
            searchResultHint: document.getElementById('search-result-hint'),
            searchKeyword: document.getElementById('search-keyword'),
            searchResultCount: document.getElementById('search-result-count'),
            
            // 歌曲列表
            songList: document.querySelector('#songs-container ul'),
            
            // 播放控制
            playPauseBtn: document.getElementById('play-pause-btn'),
            prevBtn: document.getElementById('prev-btn'),
            nextBtn: document.getElementById('next-btn'),
            progressBar: document.getElementById('progress-bar'),
            currentTime: document.getElementById('current-time'),
            totalTime: document.getElementById('total-time'),
            nowPlayingTitle: document.getElementById('now-playing-title'),
            nowPlayingArtist: document.getElementById('now-playing-artist'),
            nowPlayingCover: document.querySelector('#now-playing-cover img'),
            
            // 歌单相关
            playlistBtn: document.getElementById('playlist-btn'),
            playlistCount: document.getElementById('playlist-count'),
            playlistModal: document.getElementById('playlist-modal'),
            closePlaylistBtn: document.getElementById('close-playlist-btn'),
            playlistSongs: document.getElementById('playlist-songs'),
            emptyPlaylist: document.getElementById('empty-playlist'),
            
            // 错误重试
            retryBtn: document.getElementById('retry-btn')
        };

        // 初始化
        function init() {
            // 从本地存储加载歌单
            loadPlaylistFromStorage();
            updatePlaylistUI();
            
            // 设置事件监听
            setupEventListeners();
            setupAudioEvents();
            
            // 加载歌曲列表
            fetchSongList();
        }

        /**
         * 从GitHub仓库获取歌曲列表
         * 注意：由于GitHub的CORS限制，这里使用了一个简单的方式
         * 实际应用中可能需要使用GitHub Pages或代理服务
         */
        async function fetchSongList() {
            try {
                // 注意：这里假设你有一个songlist.txt文件列出所有歌曲名
                // 或者你可以直接在代码中维护歌曲列表
                const response = await fetch(`${SONGS_BASE_URL}/songlist.txt`);
                
                if (!response.ok) {
                    throw new Error('无法获取歌曲列表');
                }
                
                const text = await response.text();
                const songFileNames = text.split('\n')
                    .map(name => name.trim())
                    .filter(name => name && (name.endsWith('.mp3') || name.endsWith('.wav') || name.endsWith('.ogg')));
                
                // 解析歌曲信息
                allSongs = songFileNames.map((fileName, index) => {
                    // 移除文件扩展名
                    const nameWithoutExt = fileName.replace(/\.(mp3|wav|ogg)$/i, '');
                    
                    // 拆分歌曲名和歌手（格式：歌曲名-歌手）
                    const separatorIndex = nameWithoutExt.lastIndexOf('-');
                    let title, artist;
                    
                    if (separatorIndex > 0 && separatorIndex < nameWithoutExt.length - 1) {
                        title = nameWithoutExt.substring(0, separatorIndex).trim();
                        artist = nameWithoutExt.substring(separatorIndex + 1).trim();
                    } else {
                        title = nameWithoutExt.trim();
                        artist = "未知歌手";
                    }
                    
                    return {
                        id: index + 1,
                        title: title,
                        artist: artist,
                        fileName: fileName,
                        url: `${SONGS_BASE_URL}/${encodeURIComponent(fileName)}`,
                        cover: `https://picsum.photos/seed/${title}-${artist}/200/200`
                    };
                });
                
                // 初始化过滤列表
                filteredSongs = [...allSongs];
                
                // 显示歌曲列表
                renderSongList(filteredSongs);
                elements.loadingState.classList.add('hidden');
                elements.songsContainer.classList.remove('hidden');
                
            } catch (error) {
                console.error('加载歌曲失败:', error);
                elements.loadingState.classList.add('hidden');
                elements.errorState.classList.remove('hidden');
            }
        }

        /**
         * 渲染歌曲列表
         */
        function renderSongList(songs) {
            elements.songList.innerHTML = '';
            
            if (songs.length === 0) {
                elements.songsContainer.classList.add('hidden');
                elements.emptyResultState.classList.remove('hidden');
                return;
            }
            
            elements.emptyResultState.classList.add('hidden');
            elements.songsContainer.classList.remove('hidden');
            
            songs.forEach((song, index) => {
                const isInPlaylist = playlist.some(p => p.id === song.id);
                
                const li = document.createElement('li');
                li.className = `p-3 hover:bg-gray-50 transition-colors ${currentState.currentSong?.id === song.id ? 'bg-primary/5' : ''}`;
                li.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-10 h-10 rounded overflow-hidden mr-3 flex-shrink-0">
                                <img src="${song.cover}" alt="${song.title} 封面" class="w-full h-full object-cover">
                            </div>
                            <div>
                                <h3 class="font-medium text-sm">${song.title}</h3>
                                <p class="text-gray-500 text-xs">${song.artist}</p>
                            </div>
                        </div>
                        <button class="favorite-btn p-2 ${isInPlaylist ? 'text-red-500' : 'text-gray-400'}" data-id="${song.id}">
                            <i class="fa ${isInPlaylist ? 'fa-heart' : 'fa-heart-o'}"></i>
                        </button>
                    </div>
                `;
                
                // 点击播放歌曲
                li.addEventListener('click', (e) => {
                    // 如果点击的是收藏按钮，则不播放
                    if (!e.target.closest('.favorite-btn')) {
                        playSong(song.id);
                    }
                });
                
                // 收藏按钮事件
                const favoriteBtn = li.querySelector('.favorite-btn');
                favoriteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleFavorite(song.id);
                });
                
                elements.songList.appendChild(li);
            });
        }

        /**
         * 播放指定歌曲
         */
        function playSong(songId) {
            const song = allSongs.find(s => s.id === songId);
            if (!song) return;
            
            // 更新当前播放状态
            currentState.currentSong = song;
            currentState.isPlaying = true;
            
            // 加载并播放音频
            audioElement.src = song.url;
            audioElement.play().catch(error => {
                console.error('播放失败:', error);
                alert('无法播放此歌曲，可能是网络问题或格式不支持');
                currentState.isPlaying = false;
                updatePlayPauseButton();
            });
            
            // 更新UI
            updateNowPlayingInfo();
            updatePlayPauseButton();
            highlightCurrentSong();
        }

        /**
         * 切换播放/暂停
         */
        function togglePlayPause() {
            if (!currentState.currentSong) return;
            
            if (currentState.isPlaying) {
                audioElement.pause();
            } else {
                audioElement.play();
            }
        }

        /**
         * 播放下一首
         */
        function playNextSong() {
            if (!currentState.currentSong || filteredSongs.length === 0) return;
            
            const currentIndex = filteredSongs.findIndex(s => s.id === currentState.currentSong.id);
            const nextIndex = (currentIndex + 1) % filteredSongs.length;
            playSong(filteredSongs[nextIndex].id);
        }

        /**
         * 播放上一首
         */
        function playPrevSong() {
            if (!currentState.currentSong || filteredSongs.length === 0) return;
            
            const currentIndex = filteredSongs.findIndex(s => s.id === currentState.currentSong.id);
            const prevIndex = (currentIndex - 1 + filteredSongs.length) % filteredSongs.length;
            playSong(filteredSongs[prevIndex].id);
        }

        /**
         * 切换歌曲收藏状态
         */
        function toggleFavorite(songId) {
            const song = allSongs.find(s => s.id === songId);
            if (!song) return;
            
            const indexInPlaylist = playlist.findIndex(p => p.id === songId);
            
            if (indexInPlaylist === -1) {
                // 添加到歌单
                playlist.push(song);
            } else {
                // 从歌单移除
                playlist.splice(indexInPlaylist, 1);
            }
            
            // 保存到本地存储
            savePlaylistToStorage();
            
            // 更新UI
            updateFavoriteButton(songId);
            updatePlaylistUI();
        }

        /**
         * 更新收藏按钮状态
         */
        function updateFavoriteButton(songId) {
            const btn = document.querySelector(`.favorite-btn[data-id="${songId}"]`);
            if (!btn) return;
            
            const isInPlaylist = playlist.some(p => p.id === songId);
            btn.className = `favorite-btn p-2 ${isInPlaylist ? 'text-red-500' : 'text-gray-400'}`;
            btn.innerHTML = `<i class="fa ${isInPlaylist ? 'fa-heart' : 'fa-heart-o'}"></i>`;
        }

        /**
         * 更新歌单UI
         */
        function updatePlaylistUI() {
            // 更新歌单计数
            if (playlist.length > 0) {
                elements.playlistCount.textContent = playlist.length;
                elements.playlistCount.classList.remove('hidden');
                elements.emptyPlaylist.classList.add('hidden');
            } else {
                elements.playlistCount.classList.add('hidden');
                elements.emptyPlaylist.classList.remove('hidden');
            }
            
            // 渲染歌单歌曲
            elements.playlistSongs.innerHTML = '';
            
            if (playlist.length > 0) {
                elements.emptyPlaylist.classList.add('hidden');
                
                playlist.forEach(song => {
                    const div = document.createElement('div');
                    div.className = 'flex items-center justify-between p-3 border-b border-gray-100 last:border-0';
                    div.innerHTML = `
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded overflow-hidden mr-3 flex-shrink-0">
                                <img src="${song.cover}" alt="${song.title} 封面" class="w-full h-full object-cover">
                            </div>
                            <div class="overflow-hidden">
                                <h4 class="text-sm font-medium truncate">${song.title}</h4>
                                <p class="text-xs text-gray-500 truncate">${song.artist}</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button class="playlist-play-btn p-1 text-gray-500 hover:text-primary" data-id="${song.id}">
                                <i class="fa fa-play"></i>
                            </button>
                            <button class="playlist-remove-btn p-1 text-gray-400 hover:text-red-500" data-id="${song.id}">
                                <i class="fa fa-times"></i>
                            </button>
                        </div>
                    `;
                    
                    // 播放按钮
                    div.querySelector('.playlist-play-btn').addEventListener('click', () => {
                        playSong(song.id);
                        elements.playlistModal.classList.add('hidden');
                    });
                    
                    // 移除按钮
                    div.querySelector('.playlist-remove-btn').addEventListener('click', () => {
                        toggleFavorite(song.id);
                    });
                    
                    elements.playlistSongs.appendChild(div);
                });
            } else {
                elements.playlistSongs.appendChild(elements.emptyPlaylist);
            }
        }

        /**
         * 保存歌单到本地存储
         */
        function savePlaylistToStorage() {
            try {
                // 只保存必要的信息
                const simplifiedPlaylist = playlist.map(song => ({
                    id: song.id,
                    title: song.title,
                    artist: song.artist,
                    fileName: song.fileName,
                    url: song.url,
                    cover: song.cover
                }));
                
                localStorage.setItem('xiaosheng_music_playlist', JSON.stringify(simplifiedPlaylist));
            } catch (error) {
                console.error('保存歌单失败:', error);
            }
        }

        /**
         * 从本地存储加载歌单
         */
        function loadPlaylistFromStorage() {
            try {
                const stored = localStorage.getItem('xiaosheng_music_playlist');
                if (stored) {
                    playlist = JSON.parse(stored);
                }
            } catch (error) {
                console.error('加载歌单失败:', error);
                playlist = [];
            }
        }

        /**
         * 搜索歌曲（模糊搜索歌名和歌手）
         */
        function searchSongs(query) {
            const keyword = query.trim().toLowerCase();
            
            if (keyword === '') {
                filteredSongs = [...allSongs];
                elements.searchResultHint.classList.add('hidden');
            } else {
                filteredSongs = allSongs.filter(song => 
                    song.title.toLowerCase().includes(keyword) || 
                    song.artist.toLowerCase().includes(keyword)
                );
                
                // 显示搜索结果提示
                elements.searchKeyword.textContent = query;
                elements.searchResultCount.textContent = filteredSongs.length;
                elements.searchResultHint.classList.remove('hidden');
            }
            
            renderSongList(filteredSongs);
        }

        /**
         * 更新当前播放信息
         */
        function updateNowPlayingInfo() {
            if (!currentState.currentSong) return;
            
            elements.nowPlayingTitle.textContent = currentState.currentSong.title;
            elements.nowPlayingArtist.textContent = currentState.currentSong.artist;
            elements.nowPlayingCover.src = currentState.currentSong.cover;
            elements.nowPlayingCover.alt = `${currentState.currentSong.title} 封面`;
        }

        /**
         * 更新播放/暂停按钮状态
         */
        function updatePlayPauseButton() {
            if (currentState.isPlaying) {
                elements.playPauseBtn.innerHTML = '<i class="fa fa-pause"></i>';
            } else {
                elements.playPauseBtn.innerHTML = '<i class="fa fa-play"></i>';
            }
        }

        /**
         * 高亮当前播放的歌曲
         */
        function highlightCurrentSong() {
            document.querySelectorAll('#songs-container li').forEach(li => {
                const songId = parseInt(li.querySelector('.favorite-btn').dataset.id);
                if (songId === currentState.currentSong?.id) {
                    li.classList.add('bg-primary/5');
                } else {
                    li.classList.remove('bg-primary/5');
                }
            });
        }

        /**
         * 格式化时间（秒 -> MM:SS）
         */
        function formatTime(seconds) {
            if (isNaN(seconds) || seconds < 0) return "0:00";
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' + secs : secs}`;
        }

        /**
         * 设置音频事件监听
         */
        function setupAudioEvents() {
            // 元数据加载完成
            audioElement.addEventListener('loadedmetadata', () => {
                elements.totalTime.textContent = formatTime(audioElement.duration);
            });
            
            // 播放进度更新
            audioElement.addEventListener('timeupdate', () => {
                if (audioElement.duration > 0) {
                    const progress = (audioElement.currentTime / audioElement.duration) * 100;
                    elements.progressBar.style.width = `${progress}%`;
                    elements.currentTime.textContent = formatTime(audioElement.currentTime);
                }
            });
            
            // 播放状态改变
            audioElement.addEventListener('play', () => {
                currentState.isPlaying = true;
                updatePlayPauseButton();
            });
            
            audioElement.addEventListener('pause', () => {
                currentState.isPlaying = false;
                updatePlayPauseButton();
            });
            
            // 播放结束，自动播放下一首
            audioElement.addEventListener('ended', playNextSong);
            
            // 播放错误
            audioElement.addEventListener('error', () => {
                console.error('音频错误:', audioElement.error);
                alert('播放失败，请尝试其他歌曲');
                currentState.isPlaying = false;
                updatePlayPauseButton();
            });
        }

        /**
         * 设置事件监听
         */
        function setupEventListeners() {
            // 播放控制
            elements.playPauseBtn.addEventListener('click', togglePlayPause);
            elements.prevBtn.addEventListener('click', playPrevSong);
            elements.nextBtn.addEventListener('click', playNextSong);
            
            // 进度条点击
            elements.progressBar.parentElement.addEventListener('click', (e) => {
                if (!currentState.currentSong || !audioElement.duration) return;
                
                const rect = elements.progressBar.parentElement.getBoundingClientRect();
                const clickPosition = (e.clientX - rect.left) / rect.width;
                audioElement.currentTime = clickPosition * audioElement.duration;
            });
            
            // 搜索
            elements.searchInput.addEventListener('input', (e) => {
                searchSongs(e.target.value);
            });
            
            // 歌单
            elements.playlistBtn.addEventListener('click', () => {
                elements.playlistModal.classList.remove('hidden');
                elements.playlistModal.classList.add('flex');
            });
            
            elements.closePlaylistBtn.addEventListener('click', () => {
                elements.playlistModal.classList.add('hidden');
                elements.playlistModal.classList.remove('flex');
            });
            
            // 点击歌单背景关闭
            elements.playlistModal.addEventListener('click', (e) => {
                if (e.target === elements.playlistModal) {
                    elements.playlistModal.classList.add('hidden');
                    elements.playlistModal.classList.remove('flex');
                }
            });
            
            // 错误重试
            elements.retryBtn.addEventListener('click', () => {
                elements.errorState.classList.add('hidden');
                elements.loadingState.classList.remove('hidden');
                fetchSongList();
            });
        }

        // 启动应用
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>




